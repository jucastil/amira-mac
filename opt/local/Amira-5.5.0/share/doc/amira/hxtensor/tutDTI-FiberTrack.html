<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
<head><title>Amira Online Help</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" href="../Amira.css" type="text/css" />
<script type="text/javascript" src="../MathJax/MathJax.js?config=default.js"></script>
</head>
<body lang="en">


<p></p>
<h2><a name="A1">15.5 Fiber Tracking Tutorial</a></h2>
<p>This tutorial gives step-by-step instructions on fiber tracking in <font face="helvetica">Amira</font>. The tutorial assumes that the user is familiar with generating a tensor field (see tutorials on <a class="link" href="tutDTI-DataPreprocess.html#A1">data pre-processing</a> and
<a class="link" href="tutDTI-Tensor.html#A1">tensor computation</a>). 
Alternatively, an analytic tensor field generated by <a class="link" href="HxGenerateTensorData.html#A1">AnalyticTensorField</a> can be sampled by <em>ArithmeticTensor</em> and used for large parts of this tutorial.</p>
<p><b>Note</b> that the tutorial is rather demanding with respect to memory usage so that some steps may fail or become slow on 32 Bit systems. It is recommended, therefore, to conduct this tutorial on a 64 Bit workstation with sufficient physical memory installed.</p>
<p>The tutorial will cover the following topics:
</p>
<ul><li>Perform fiber tracking,</li><li>Separate fibers into fiber bundles.</li>
</ul><p></p>
<p></p>
<h3><a name="A2">15.5.1 Perform fiber tracking</a></h3>
<p>Fiber tracking visualizes restricted water diffusion and correlates well with axonal fiber tracts in the white matter. Instead of displaying glyphs or color values for each voxel, an integration starting at seed voxel locations provides a more direct comparison with tracts seen in the brain. It has to be stressed that there is no direct comparison of the fibers generated by fiber tracking with the axonal fiber bundles in the brain. The measurement resolution of the MR scans is much too low to allow any direct display of single fibers. Also, we do not measure the tracts directly but just an effect that these structures have on water diffusion. Nevertheless, fiber tracking has proven to be a valuable tool for accessing the major connection pathways in the brain. Note, however, that especially in cases with tumors like the one provided with this tutorial, care has to be taken in interpreting the data. This is because tumor oedema might disturb diffusion and thus might erroneously indicate fiber-free regions.</p>
<p>We start by generating the tensor with a script:
</p>
<ul><li>Load the script <tt>data/tutorials/DTIFiberTracking_start.hx</tt>.</li>
</ul><p>
This creates the tensor field from the existing files in the tutorial directory. A detailed tutorial on how to create the tensor from the gradient weighted images is given in <a class="link" href="tutDTI-Tensor.html#A3">Tensor Computation</a>.
</p>
<ul><li>Connect the module <a class="link" href="HxExtractEigenvalues.html#A1">ExtractEigenvalues</a> to the tensor field.</li><li>Load the brain mask that comes with the tutorial data from <tt>data/tutorials/DTI/T1-BrainLabels.am</tt>.</li><li>To prevent eigenvalues from being computed in areas that are outside the brain and defined by noise only, connect the <em>Mask</em> connection port of <em>ExtractEigenvalues</em> with the <em>T1-BrainLabels.am</em> object.</li><li>Press the <em>Apply</em> button and four new volumes are created. Three volumes (<em>B0._evec1</em>, <em>B0._evec2</em> and <em>B0._evec3</em>) are vector fields that represent the first, or principal eigenvector direction, the second and third eigenvectors, respectively. The fourth field (<em>B0._evals</em>) contains the eigenvalues for each of the three eigenvectors sorted by size.</li>
</ul><p>
The eigenvalue decomposition is a step that converts the tensor information into a more manageable format. The vector of the first eigenvector points in the direction of largest elongation of the tensor as displayed by <em>TensorDisplay</em>. The corresponding first eigenvalue encodes the strength of the diffusion in that direction.</p>
<p>The process of fiber tracking is done in two parts. First a set of fibers is created, usually at a density high enough so that regions of interest are represented sufficiently well. In a second step the fibers are pruned. In this way a single fiber tract like the pyramidal tract can be followed through the brain and is not obstructed by competing fiber bundles.</p>
<p>Fiber tracking is performed by module <a class="link" href="HxFiberTracking.html#A1">FiberTacking</a> that needs to be connected to the first principal eigenvector generated from the tensor field (<em>B0._evec1</em>) by <a class="link" href="HxExtractEigenvalues.html#A1">ExtractEigenvalues</a>. The module will connect on its own to the field which contains the eigenvalues based on the name of the connected eigenvector field. In order to work, <em>FiberTracking</em> needs an additional input label field. </p>
<p>The connection to the <em>Mask</em> connection port is required and ensures that no fibers are generated outside the brain. The mask also directs the generation of seed point which are the voxels at which fiber lines start.</p>
<p></p>
<ul><li>Connect the <a class="link" href="HxFiberTracking.html#A1">Fibertracking</a> module to the principal eigenvector field (B0._evec1).</li><li>Connect the mask image B0-Brainlabels.am to the <em>Mask</em> connection port of the Fibertracking module.</li>
</ul><p></p>
<p>Module <em>FiberTracking</em> provides three algorithms that can improve the tracking in case of noise in the data. The optional fiber tracking algorithm tensor deflection is used, if together with the eigenvectors and eigenvalues also a tensor field is connected to <em>FiberTracking</em> (connection port <em>Tensor</em>). The two ports <em>Tensor weight g</em> and <em>Tensor weight f</em> control the influence of streamline fiber tracking and tensor deflection on the resulting fibers.</p>
<p>This type of fiber tracking provides a smoothing effect that can
degrade high curvature fiber tracts and has therefore to be used with
care. In areas with crossing or touching fiber bundles, tensor
deflection can be used as a means of supporting continuation of
the fiber direction. In general, simple streamline fiber tracking is
sufficient to extract a representation of major fiber tracts.</p>
<p></p>
<ul><li>Change the default <em>FASeed threshold</em> of <em>FiberTracking</em> to a value of 0.2. The fractional anisotropy is a measure of the directional specificity, which is larger inside fiber bundles. Small fiber tracts will have lower values due to partial volume effects so a reduction in the threshold value will allow more seed points and therefore more fibers to be placed in the areas of interest.</li><li>Change the default <em>FAStop threshold</em> to a value of 0.1. Fibers are traced from their seed point located in the start region until a voxel is reached with a fractional anisotropy that is smaller than this threshold.</li><li>Press the <em>Apply</em> button.</li><li>Select <em>No</em> in the dialog box presented to prevent the <em>Brain</em> label from being used as a seed area. Fibers for smaller regions of interest are computed automatically and put into the Pool.</li>
</ul><p></p>
<p>For larger areas the fiber tracking module will present a dialog box and ask the user if the region should be used as a seed region. Small regions like the corpus callosum or seed regions in the brain stem will automatically result in one line set per material. Fibers are started in their seed regions but traced in all non-Exterior regions, which makes it essential that the brain mask contain the whole brain.</p>
<p><em>FiberTracking</em> will create <a class="link" href="../hxlines/HxLineSet.html#A1">LineSet</a> objects for each label in the connected <em>Mask</em> data set. They represent fiber bundles for the materials <em>BS1</em> and <em>BS2</em>. These regions are close to the brain stem and contain ascending fibers. Some of them reach up through the pyramidal tract into the motor cortex.</p>
<p>Each line contains additional data values for each vertex. The first value is the local fractional anisotropy, the next values are the three local eigenvalues and a time stamp generated during the integration in the tensor field.</p>
<p>The line sets can be displayed using <a class="link" href="../hxlines/HxDisplayLineSet.html#A1">LineSetView</a> or <a class="link" href="../hxisl/HxDisplayISL.html#A1">DisplayISL</a> (the latter requires an AmiraMesh license). These modules are fast enough to render larger numbers of fibers.</p>
<p></p>
<h3><a name="A3">15.5.2 Separate Fibers into Fiber Bundles</a></h3>
<p>In order to remove fibers that are not required, the <a class="link" href="../hxlines/HxSelectLines.html#A1">SelectLines</a> module is used. But before we start using the module, we need to create a display that shows the structures that we are interested in. This will help with the navigation required to extract individual fiber bundles.</p>
<p></p>
<ul><li>Load the surface representation of the mask label field from <tt>data/tutorials/DTI/T1-BrainLabels.surf</tt>.</li><li>Connect a <a class="link" href="../hxsurftools/HxDisplaySurface.html#A1">SurfaceView</a> module to the surface object and select in the <em>Materials</em> port <em>All All</em>. Press the <em>Add</em> button. Now also inside triangles are displayed.</li><li>Set the <em>Draw Style port</em> of <em>SurfaceView</em> to <em>transparent</em>.</li><li>Connect a <a class="link" href="../hxlines/HxDisplayLineSet.html#A1">LineSetView</a> module to the <em>LineSet_BS2 object</em>.</li>
</ul><p>
The brain surface, the tumor, the corpus callosum, and the two brainstem areas are visible together with line sets that represent the fibers initiating from the right side of the brainstem.</p>
<p></p>
<ul><li>Connect <a class="link" href="../hxlines/HxSelectLines.html#A1">SelectLines</a> to the LineSet_BS2. A <a class="link" href="../hxfield/HxSelectRoi.html#A1">SelectROI</a> module will be automatically connected to the line set and to the <em>SelectLines</em> module.</li><li>Adjust the location of the <em>SelectROI</em> dragger box by selecting the green handles in the viewer in interactive (arrow) mode.</li><li>Press the <em>Apply</em> button and a new line set object is created which contains only fibers that touch the defined region of interest.</li>
</ul><p></p>
<p><em>SelectROI</em> is used to adjust the location of the end region. A second or third <em>SelectROI</em> can be created for the line set and connected to the additional input connections of <em>SelectLines</em>. The filtering is provided by <em>SelectLines</em> in a way that its output will only display fibers that have vertices that are inside all of the regions of interest. By adjusting the position and size of the regions of interest a subset of fibers is created as output line set. It is convenient to use the <em>auto-refresh</em> checkbox of <em>SelectLines</em> to be able to visualize fibers while moving the <em>SelectROI</em>.</p>
<p></p><a name="A4"></a><a href=tutDTI-FiberTrack_PyramidalSideBySide.png.html><img width=637 src="tutDTI-FiberTrack_PyramidalSideBySide.png" /></a><br />
<div class="caption">
<b>Figure 167:</b>
Example location of <em>SelectRoi</em> module for extraction of pyramidal tract. The line set is displayed using <em>LineSetView</em> before (left) and after the extraction (right).</div>

 

<p></p>
<p><em>SelectLines</em> also allows the user to mask lines based on the values attached to the vertices or by an additional label field.</p>
<p></p>
<h3><a name="A5">15.5.3 Create a label field from a line set</a></h3>
<p>In some cases it is beneficial to be able to create a label field from the generated line sets. The label field can be used to create a surface representation of the fiber bundle or to export a data set that overlays the fiber bundle with the anatomical data. The <em>FiberTracking</em> module contains a convenient Tcl command that generates such a label field. 
</p>
<ul><li>Make sure that a <a class="link" href="HxFiberTracking.html#A1">FiberTracking</a> module is available in the Pool together with the line set that needs to be converted into a label field.</li><li>Enter the following command into the <font face="helvetica">Amira</font> console window: <tt>FiberTracking createLabelField LineSet_BS2 100 100 100</tt></li>
</ul><p>
This will create a new label field with the dimensions 100$$\times$$100$$\times$$100 that contains for each vertex of the line set object the value 1 against a uniform background with the value 0.

</p></body>
</html>
