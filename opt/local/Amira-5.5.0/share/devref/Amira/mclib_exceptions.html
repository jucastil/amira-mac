<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Amira: Error Handling and Debugging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="AmiraDevRef.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1><a class="anchor" name="mclib_Exceptions">Error Handling and Debugging</a></h1><h2><a class="anchor" name="History">
History</a></h2>
<ul>
<li>2007-11-12: copied and adapted to mclib</li><li>July 15, 2005: initial version</li></ul>
<h2><a class="anchor" name="mclib_Exceptions_intro">
Introduction</a></h2>
<h2><a class="anchor" name="mclib_Exceptions_dev">
Developer's view: Debugging</a></h2>
Support for development (for example marking unfinished code) and debugging is useful.<p>
For developers the detailed context (call stack, source code line) is important. A log of the running application may also be helpful. When running debugging builds, paying run time penalties for detailed information is acceptable. Typical scenarios are<ul>
<li>An assertion failed and a debugger is available and attached. Calling abort() will trap to the debugger and a callstack is available.</li><li>An assertion failed but no debugger was attached. Calling abort would delete all context information. Putting the program on hold and providing options to the developer may be helpful, for example<ul>
<li>attaching a debugger manually and abort()ing afterwards</li><li>printing the callstack and aborting</li><li>ignoring failed assertion once or always (e.g. in unfinished code)</li></ul>
</li><li>Logging: A constant flow of information, function entry, exit and debugging messages is generated to trace program execution. After a crash this may give some hints.</li></ul>
<p>
These use cases are covered by the related page <a class="el" href="group__mclib__mcassert.html">Debugging, Callstack, Assertions, Precondition, Postcondition</a>.<p>
But don't mix debugging with error management, which is described in the the next section.<h2><a class="anchor" name="mclib_Exceptions_user">
User's view: Error Messages</a></h2>
Executing a production quality application may nontheless lead to error conditions. They may either be caused by programming errors or by the environment the applications is running in (e.g. network failure, configuration failures). The application should deal gracefully with such errors and provide human readable error messages to the user. Typical users don't want to learn about source code line numbers or callstacks. But they may be interested in details to find out if they can fix the error.<p>
Inspired by the article 'Dissecting Error Messages' by Alek Davis (DDJ 06/2005) the following scheme is proposed. Useful error messages should start with a high level context and add more and more details afterwards. An example for a useful error message is: "Failed to retreive data. A network error occured. TCP connection refused to server.example.com. connect() failed: network unreachable.". Such an error may have occured deep inside the callstack, for example main called A, which called B, which called C. Starting with C the message is built.<p>
<div class="fragment"><pre class="fragment">    Message Returned                            Message Appended

                          in main            n A             in B                in C

    from C                                                               Step X failed: Reason
    from B                                               Cannot do C.    Step X failed: Reason
    from A                               Cannot do B.    Cannot do C.    Step X failed: Reason
    from main            Cannot do A.    Cannot do B.    Cannot do C.    Step X failed: Reason


Example from above: Failed to retreive. Network error. Connection refused. connect() failed: network unreachable.

</pre></div><p>
This maps well to an exception that is thrown in C, annotated in the other functions, rethrown, and finally printed in main. <a class="el" href="class_mc_exception.html">McException</a> provides such a framework. Code printing the above message would look like<p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> C () {
    <span class="keywordflow">if</span> (connect(fd, adr, len) == -1) {
        <a class="code" href="group__mclib.html#g51caaa29fb26899ccf6eccd7ffeb478f">mcthrow</a> (<a class="code" href="class_mc_string.html">McString</a> (0, <span class="stringliteral">"connect() failed: %s"</span>, strerror (errno)));
    }
}

<span class="keywordtype">void</span> B () {
    <span class="keywordflow">try</span> {
        <span class="comment">// ...</span>
    } <span class="keywordflow">catch</span> (mc::Exception&amp; e) {
        <a class="code" href="group__mclib.html#g8e1be0b02566470c9ab0b5c598422d4d">mcrethrow</a> (e, <span class="stringliteral">"Connection refused"</span>);
    }
}

<span class="keywordtype">void</span> A () {
    <span class="keywordflow">try</span> {
        <span class="comment">// ...</span>
    } <span class="keywordflow">catch</span> (mc::Exception&amp; e) {
        <a class="code" href="group__mclib.html#g8e1be0b02566470c9ab0b5c598422d4d">mcrethrow</a> (e, <span class="stringliteral">"Network Error"</span>);
    }
}

<span class="keywordtype">int</span> main () {
    <span class="keywordflow">try</span> {
        <span class="comment">// ...</span>
    } <span class="keywordflow">catch</span> (mc::Exception&amp; e) {
        fprintf (stderr, <span class="stringliteral">"Failed to retrieve.\n"</span>);
        fprintf (stderr, <span class="stringliteral">"%s"</span>, e.what());
    }
}
</pre></div><p>
Side note: You may want to translate exceptions to a different type. This can be achieved by (Note the example is constructed. We do not use types to differentiate causes of exceptions.)<p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> B () {
    <span class="keywordflow">try</span> {
        <span class="comment">// ...</span>
    } <span class="keywordflow">catch</span> (mc::SomeThingException&amp; e) {
        McIOException f(e);
        <a class="code" href="group__mclib.html#g8e1be0b02566470c9ab0b5c598422d4d">mcrethrow</a>(f, <span class="stringliteral">"Connection refused"</span>);
    }
}
</pre></div><p>
If you run code in background threads, it may be useful to store an exception and rethrow it later in the main thread. The exception provides a method <a class="el" href="class_mc_exception.html#fc10f3eeb027481e80e5427aa075caf7">McException::clone()</a> to generate a copy of the correct, derived type. Later, <a class="el" href="class_mc_exception.html#b0d021659d7a06857a931a2e832033d9">McException::raise()</a> will throw an exception of the derived type. Use<p>
<div class="fragment"><pre class="fragment">std::auto_ptr&lt;mc::Exception&gt; stored_exception;

<span class="keywordtype">void</span> background() {
    <span class="keywordflow">try</span> {
        <span class="comment">// ...</span>
    } <span class="keywordflow">catch</span> (mc::Exception&amp; e) {
        stored_exception.reset(e-&gt;clone());
    }
}

<span class="keywordtype">void</span> retrieve_result() {
    <span class="keywordflow">if</span> (stored_exception.get()) {
        stored_exception-&gt;raise();
    }
}

main () {
    Thread(background); <span class="comment">// code to execute background in another thread</span>

    <span class="keywordflow">try</span> {
        retrieve_result ();
    } <span class="keywordflow">catch</span> (mc::Exception&amp; e) {
        fprintf( stderr, <span class="stringliteral">"An error occured in a background thread"</span> );
        fprintf( stderr, <span class="stringliteral">"%s"</span>, e.what() );
    }
}
</pre></div><p>
In case of a programming error, developers may be interested in the detailed context. In the debugging version the original <a class="el" href="class_mc_exception.html">McException</a> captures the call stack and all mcrethrow macros will add file and line number information. The final output will contain a backtrace and all information gathered during stack unwinding. <a class="el" href="class_mc_exception.html#fc10f3eeb027481e80e5427aa075caf7">McException::clone()</a>/McExceptionraise() will keep the original callstack. All these operations are only needed in case of error. Thus, the framework nicely fits into the C++ exception handling. Overhead only occurs in case of error.<h2><a class="anchor" name="Summary">
Summary</a></h2>
The described framework provides rich error messages to the user, and detailed context information to the developer (in debug builds). For debugging and prototyping mcassert and friends may be useful. Avoid mixing debug logging with error handling. You can provide both, but you should always provide error handling. <hr class="footer"/><address style="text-align: right;"><small>
<a href="http://www.vsg3d.com/" target="_blank">Amira</a> Developer Reference
- &copy; 2005 - 2011 <a href="http://www.zib.de/" target="_blank">Zuse Institute Berlin</a>,
<a href="http://www.vsg3d.com" target="_blank">Visualization Sciences Group, SAS</a>
- Generated on 10 Oct 2013 using <a href="http://www.doxygen.org/" target="_blank">doxygen</a> 1.4.7
</small></address>
</body>
</html>
